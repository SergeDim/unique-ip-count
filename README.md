# unique-ip-count
(c) Sergei Dmitriev aka SergeDim for Lightspeed

## Описание решения

Данное консольное приложение предназначено для подсчёта количество уникальных IP-адресов в текстовом файле вида:  
(один ip-адрес на строке)
```
145.67.23.4
8.34.5.23
89.54.3.124
89.54.3.124
3.45.71.5
...
```
Результат выводится в консоль.  
Во время работы приложения выводится статистика по количеству обработанных адресов и текущей позиции в файле.
```
offset: 58 413 Mb;  6 527 655 (ip/sec)
```
Конечный результат выводится в виде:
```
Unique IPs = 4 294 967 296
Time = 821,700 (c)
```

Возможен режим запуска без подсчёта статистики для использования в скриптах в качестве утилиты.
(ключ -nostat).
В этом случае в System.out будет выведен только конечный результат подсчёта:
```
4294967296
```

### Требования, учитываемые при разработке:
1. Минимизировать время обработки файла.
2. Минимизировать используемую память.
3. Максимизировать эффективность использования вычислительных ресурсов.

## Сборка проекта
Сборка производится сборщиком maven.
```
mvn clean package
```
Результатом будет файл `unique-ip-counter-1.0.0.jar` в папке target.

## Запуск приложения
При запуске без параметров выводится подсказка:
```
Unique IPs counter (c) SergeDim for Lightspeed
Usage:
java -jar count-unique-ip.jar <ip_file.txt> [-nostat]
```
- **<ip_file.txt>** - путь до файла с IP адресами;
- **-nostat** - необязательный параметр, указывающий что нужен "чистый" результат, без статистики.

Никаких специальных параметров VM не требуется, приложение требует ~1Гб памяти и работает с настройками по умолчанию.

## Ограничения и допущения
- 1 строка - 1 IP адрес.
- Перевод строки может быть как в win, так и в unix формате: \r\n или \n.
- Пустые строки пропускаются.
- В конце и в начале строки может быть любое количество пробелов или табуляций \t.
- Некорректные IP-адреса пропускаются.

Пример корректного файла:
```
    111.111.111.111

145.67.23.4

  8.34.5.23  
89.54.3.124   
```

## Обработка ошибок
Обрабатываются основные ошибки в IP-адресах. Следующие адреса будут признаны некорретными и будут пропущены:
```
1.1.1.x
1,1.1.1
1.1.444.1
1.1.1.
1.1.1
1.1. 1.1
```
Ошибки выводятся в System.err, соответственно:

```
Invalid IP symbol: ascii (120) 'x'
Invalid IP symbol: ascii (44) ','
Invalid IP byte value: 444
Invalid IP symbol: ascii (10) ' '
Invalid IP symbol: ascii (10) ' '
Invalid IP symbol: ascii (32) ' '
```

## Результаты тестирования
Тестирование на файле "ip_addresses" (106 Гб).  
Параметры VM по умолчанию.  
Выделенная память процесса: 1024 Мб.

1. HDD диск:
    - CPU: 15%,
    - скорость чтения: 87 Мб/с,
    - время обработки: 1258 с.,
    - скорость обработки ~6.2 млн.IP/c
    

2. SSD диск:
    - CPU: 95%,
    - скорость чтения: 436 Мб/с,
    - время обработки: 250 с.,
    - скорость обработки ~30 млн.IP/c